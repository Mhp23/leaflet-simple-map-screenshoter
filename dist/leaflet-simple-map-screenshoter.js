!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["leaflet-simple-map-screenshoter"]=e["leaflet-simple-map-screenshoter"]||{})}(this,function(e){"use strict";var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var o=n(function(e,n){!function(t){const n=function(){let e=0;return{escape:function(e){return e.replace(/([.*+?^${}()|[]\/\\])/g,"\\$1")},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):(t=e,new Promise(function(e){var n=h(t.toDataURL().split(",")[1]),o=n.length,i=new Uint8Array(o);for(let e=0;e<o;e++)i[e]=n.charCodeAt(e);e(new Blob([i],{type:"image/png"}))}));var t},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),o=n.createElement("base"),i=(n.head.appendChild(o),n.createElement("a"));return n.body.appendChild(i),o.href=t,i.href=e,i.href},getAndEncode:function(e){let t=c.impl.urlCache.find(function(t){return t.url===e});return t||(t={url:e,promise:null},c.impl.urlCache.push(t)),null===t.promise&&(c.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),t.promise=new Promise(function(t){const n=c.impl.options.httpTimeout,o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4===o.readyState)if(300<=o.status)r?t(r):s(`cannot fetch resource: ${e}, status: `+o.status);else{const e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(o.response)}},o.ontimeout=function(){r?t(r):s(`timeout of ${n}ms occured while fetching resource: `+e)},o.responseType="blob",o.timeout=n,0<c.impl.options.useCredentialsFilters.length&&(c.impl.options.useCredentials=0<c.impl.options.useCredentialsFilters.filter(t=>0<=e.search(t)).length),c.impl.options.useCredentials&&(o.withCredentials=!0),c.impl.options.corsImg&&0===e.indexOf("http")&&-1===e.indexOf(window.location.origin)){var i="POST"===(c.impl.options.corsImg.method||"GET").toUpperCase()?"POST":"GET";o.open(i,(c.impl.options.corsImg.url||"").replace("#{cors}",e),!0);let t=!1;const n=c.impl.options.corsImg.headers||{},r=(Object.keys(n).forEach(function(e){-1!==n[e].indexOf("application/json")&&(t=!0),o.setRequestHeader(e,n[e])}),function(e){try{return JSON.parse(JSON.stringify(e))}catch(e){s("corsImg.data is missing or invalid")}}(c.impl.options.corsImg.data||""));Object.keys(r).forEach(function(t){"string"==typeof r[t]&&(r[t]=r[t].replace("#{cors}",e))}),o.send(t?JSON.stringify(r):r)}else o.open("GET",e,!0),o.send();let r;function s(e){console.error(e),t("")}c.impl.options.imagePlaceholder&&(i=c.impl.options.imagePlaceholder.split(/,/))&&i[1]&&(r=i[1])})),t.promise},uid:function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++},delay:function(e){return function(t){return new Promise(function(n){setTimeout(function(){n(t)},e)})}},asArray:function(e){var t=[],n=e.length;for(let o=0;o<n;o++)t.push(e[o]);return t},escapeXhtml:function(e){return e.replace(/%/g,"%25").replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return"data:,"!==e?new Promise(function(t,n){const o=new Image;c.impl.options.useCredentials&&(o.crossOrigin="use-credentials"),o.onload=function(){window&&window.requestAnimationFrame?window.requestAnimationFrame(function(){t(o)}):t(o)},o.onerror=n,o.src=e}):Promise.resolve()},width:function(e){var t=s(e,"width");if(!isNaN(t))return t;t=s(e,"border-left-width");var n=s(e,"border-right-width");return e.scrollWidth+t+n},height:function(e){var t=s(e,"height");if(!isNaN(t))return t;t=s(e,"border-top-width");var n=s(e,"border-bottom-width");return e.scrollHeight+t+n},getWindow:n,isElement:r,isElementHostForOpenShadowRoot:function(e){return r(e)&&null!==e.shadowRoot},isShadowRoot:o,isInShadowRoot:i,isHTMLElement:function(e){return e instanceof n(e).HTMLElement},isHTMLCanvasElement:function(e){return e instanceof n(e).HTMLCanvasElement},isHTMLInputElement:function(e){return e instanceof n(e).HTMLInputElement},isHTMLImageElement:function(e){return e instanceof n(e).HTMLImageElement},isHTMLLinkElement:function(e){return e instanceof n(e).HTMLLinkElement},isHTMLScriptElement:function(e){return e instanceof n(e).HTMLScriptElement},isHTMLStyleElement:function(e){return e instanceof n(e).HTMLStyleElement},isHTMLTextAreaElement:function(e){return e instanceof n(e).HTMLTextAreaElement},isShadowSlotElement:function(e){return i(e)&&e instanceof n(e).HTMLSlotElement},isSVGElement:function(e){return e instanceof n(e).SVGElement},isSVGRectElement:function(e){return e instanceof n(e).SVGRectElement},isDimensionMissing:function(e){return isNaN(e)||e<=0}};function n(e){return((e=e?e.ownerDocument:void 0)?e.defaultView:void 0)||t||window}function o(e){return e instanceof n(e).ShadowRoot}function i(e){return null!==e&&Object.prototype.hasOwnProperty.call(e,"getRootNode")&&o(e.getRootNode())}function r(e){return e instanceof n(e).Element}function s(e,t){if(e.nodeType===u){let n=d(e).getPropertyValue(t);if("px"===n.slice(-2))return n=n.slice(0,-2),parseFloat(n)}return NaN}}(),o=function(){const e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,r){return t(e)?Promise.resolve(e).then(o).then(function(t){let o=Promise.resolve(e);return t.forEach(function(e){o=o.then(function(t){return i(t,e,n,r)})}),o}):Promise.resolve(e)},shouldProcess:t,impl:{readUrls:o,inline:i}};function t(t){return-1!==t.search(e)}function o(t){for(var o,i=[];null!==(o=e.exec(t));)i.push(o[1]);return i.filter(function(e){return!n.isDataUrl(e)})}function i(e,t,o,i){return Promise.resolve(t).then(function(e){return o?n.resolveUrl(e,o):e}).then(i||n.getAndEncode).then(function(o){return e.replace((i=t,new RegExp(`(url\\(['"]?)(${n.escape(i)})(['"]?\\))`,"g")),`$1${o}$3`);var i})}}(),i={resolveAll:function(){return r().then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})},impl:{readAll:r}};function r(){return Promise.resolve(n.asArray(document.styleSheets)).then(function(e){const t=[];return e.forEach(function(e){if(Object.prototype.hasOwnProperty.call(Object.getPrototypeOf(e),"cssRules"))try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.error("domtoimage: Error while reading CSS rules from "+e.href,t.toString())}}),t}).then(function(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return o.shouldProcess(e.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)});function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return o.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}const s={inlineAll:function e(t){return n.isElement(t)?function(e){const t=["background","background-image"].map(function(t){const n=e.style.getPropertyValue(t),i=e.style.getPropertyPriority(t);return n?o.inlineAll(n).then(function(n){e.style.setProperty(t,n,i)}):Promise.resolve()});return Promise.all(t).then(function(){return e})}(t).then(function(){return n.isHTMLImageElement(t)?a(t).inline():Promise.all(n.asArray(t.childNodes).map(function(t){return e(t)}))}):Promise.resolve(t)},impl:{newImage:a}};function a(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then(function(t){return new Promise(function(n){e.onload=n,e.onerror=n,e.src=t})})}}}const l={copyDefaultStyles:!0,imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1,useCredentialsFilters:[],httpTimeout:3e4,styleCaching:"strict",corsImg:void 0,adjustClonedNode:void 0},c={toSvg:p,toPng:function(e,t){return m(e,t).then(function(e){return e.toDataURL()})},toJpeg:function(e,t){return m(e,t).then(function(e){return e.toDataURL("image/jpeg",(t?t.quality:void 0)||1)})},toBlob:function(e,t){return m(e,t).then(n.canvasToBlob)},toPixelData:function(e,t){return m(e,t).then(function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data})},toCanvas:m,impl:{fontFaces:i,images:s,util:n,inliner:o,urlCache:[],options:{}}},u=(e.exports=c,("undefined"!=typeof Node?Node.ELEMENT_NODE:void 0)||1),d=(void 0!==t?t.getComputedStyle:void 0)||("undefined"!=typeof window?window.getComputedStyle:void 0)||globalThis.getComputedStyle,h=(void 0!==t?t.atob:void 0)||("undefined"!=typeof window?window.atob:void 0)||globalThis.atob;function p(e,t){const o=c.impl.util.getWindow(e);var i=t=t||{};void 0===i.copyDefaultStyles?c.impl.options.copyDefaultStyles=l.copyDefaultStyles:c.impl.options.copyDefaultStyles=i.copyDefaultStyles,void 0===i.imagePlaceholder?c.impl.options.imagePlaceholder=l.imagePlaceholder:c.impl.options.imagePlaceholder=i.imagePlaceholder,void 0===i.cacheBust?c.impl.options.cacheBust=l.cacheBust:c.impl.options.cacheBust=i.cacheBust,void 0===i.corsImg?c.impl.options.corsImg=l.corsImg:c.impl.options.corsImg=i.corsImg,void 0===i.useCredentials?c.impl.options.useCredentials=l.useCredentials:c.impl.options.useCredentials=i.useCredentials,void 0===i.useCredentialsFilters?c.impl.options.useCredentialsFilters=l.useCredentialsFilters:c.impl.options.useCredentialsFilters=i.useCredentialsFilters,void 0===i.httpTimeout?c.impl.options.httpTimeout=l.httpTimeout:c.impl.options.httpTimeout=i.httpTimeout,void 0===i.styleCaching?c.impl.options.styleCaching=l.styleCaching:c.impl.options.styleCaching=i.styleCaching;let r=[];return Promise.resolve(e).then(function(e){if(e.nodeType===u)return e;var t=e,n=e.parentNode,o=document.createElement("span");return n.replaceChild(o,t),o.append(e),r.push({parent:n,child:t,wrapper:o}),o}).then(function(e){return function e(t,o,i,r){const s=o.filter;return t===f||n.isHTMLScriptElement(t)||n.isHTMLStyleElement(t)||n.isHTMLLinkElement(t)||null!==i&&s&&!s(t)?Promise.resolve():Promise.resolve(t).then(function(e){return n.isHTMLCanvasElement(e)?n.makeImage(e.toDataURL()):e.cloneNode(!1)}).then(function(e){return o.adjustClonedNode&&o.adjustClonedNode(t,e,!1),Promise.resolve(e)}).then(function(i){return function(t,i){const s=function(e){return n.isShadowSlotElement(e)?e.assignedNodes():e.childNodes}(i);let a=Promise.resolve();if(0!==s.length){const l=d(function(e){return n.isShadowRoot(e)?e.host:e}(i));n.asArray(s).forEach(function(n){a=a.then(function(){return e(n,o,l,r).then(function(e){e&&t.appendChild(e)})})})}return a.then(function(){return t})}(i,function(e){return n.isElementHostForOpenShadowRoot(e)?e.shadowRoot:e}(t))}).then(function(e){return o.adjustClonedNode&&o.adjustClonedNode(t,e,!0),Promise.resolve(e)}).then(function(e){return function(e,t){return!n.isElement(e)||n.isShadowSlotElement(t)?Promise.resolve(e):Promise.resolve().then(function(){!function(e,t){const n=d(e);n.cssText?(t.style.cssText=n.cssText,function(e,t){t.font=e.font,t.fontFamily=e.fontFamily,t.fontFeatureSettings=e.fontFeatureSettings,t.fontKerning=e.fontKerning,t.fontSize=e.fontSize,t.fontStretch=e.fontStretch,t.fontStyle=e.fontStyle,t.fontVariant=e.fontVariant,t.fontVariantCaps=e.fontVariantCaps,t.fontVariantEastAsian=e.fontVariantEastAsian,t.fontVariantLigatures=e.fontVariantLigatures,t.fontVariantNumeric=e.fontVariantNumeric,t.fontVariationSettings=e.fontVariationSettings,t.fontWeight=e.fontWeight}(n,t.style)):(M(o,e,n,i,t),null===i&&(["inset-block","inset-block-start","inset-block-end"].forEach(e=>t.style.removeProperty(e)),["left","right","top","bottom"].forEach(e=>{t.style.getPropertyValue(e)&&t.style.setProperty(e,"0px")})))}(t,e)}).then(function(){const o=n.uid();[":before",":after"].forEach(function(i){!function(i){const r=d(t,i),s=r.getPropertyValue("content");if(""!==s&&"none"!==s){const t=e.getAttribute("class")||"",a=(e.setAttribute("class",t+" "+o),document.createElement("style"));a.appendChild(function(){const e=`.${o}:`+i,t=(r.cssText?function(){return`${r.cssText} content: ${s};`}:function(){return n.asArray(r).map(function(e){const t=r.getPropertyValue(e),n=r.getPropertyPriority(e)?" !important":"";return e+": "+t+n}).join("; ")+";"})();return document.createTextNode(e+`{${t}}`)}()),e.appendChild(a)}}(i)})}).then(function(){n.isHTMLTextAreaElement(t)&&(e.innerHTML=t.value),n.isHTMLInputElement(t)&&e.setAttribute("value",t.value)}).then(function(){n.isSVGElement(e)&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.isSVGRectElement(e))&&["width","height"].forEach(function(t){const n=e.getAttribute(t);n&&e.style.setProperty(t,n)})}).then(function(){return e})}(e,t)})}(e,t,null,o)}).then(g).then(w).then(function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(n){e.style[n]=t.style[n]});let n=null;return"function"==typeof t.onclone&&(n=t.onclone(e)),Promise.resolve(n).then(function(){return e})}).then(function(e){let o=t.width||n.width(e),i=t.height||n.height(e);return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(n.escapeXhtml).then(function(e){var t=(n.isDimensionMissing(o)?' width="100%"':` width="${o}"`)+(n.isDimensionMissing(i)?' height="100%"':` height="${i}"`);return`<svg xmlns="http://www.w3.org/2000/svg"${(n.isDimensionMissing(o)?"":` width="${o}"`)+(n.isDimensionMissing(i)?"":` height="${i}"`)}><foreignObject${t}>${e}</foreignObject></svg>`}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}).then(function(e){for(;0<r.length;){var t=r.pop();t.parent.replaceChild(t.child,t.wrapper)}return e}).then(function(e){return c.impl.urlCache=[],f&&(document.body.removeChild(f),f=null),y&&clearTimeout(y),y=setTimeout(()=>{y=null,v={}},2e4),e})}function m(e,t){return p(e,t=t||{}).then(n.makeImage).then(function(o){var i="number"!=typeof t.scale?1:t.scale,r=function(e,o){let i=t.width||n.width(e),r=t.height||n.height(e);return n.isDimensionMissing(i)&&(i=n.isDimensionMissing(r)?300:2*r),n.isDimensionMissing(r)&&(r=i/2),(e=document.createElement("canvas")).width=i*o,e.height=r*o,t.bgcolor&&((o=e.getContext("2d")).fillStyle=t.bgcolor,o.fillRect(0,0,e.width,e.height)),e}(e,i),s=r.getContext("2d");return s.msImageSmoothingEnabled=!1,s.imageSmoothingEnabled=!1,o&&(s.scale(i,i),s.drawImage(o,0,0)),r})}let f=null;function g(e){return i.resolveAll().then(function(t){var n;return""!==t&&(n=document.createElement("style"),e.appendChild(n),n.appendChild(document.createTextNode(t))),e})}function w(e){return s.inlineAll(e).then(function(){return e})}function M(e,t,o,i,r){const s=c.impl.options.copyDefaultStyles?function(e,t){var o=function(t){return("relaxed"!==e.styleCaching?t:t.filter((e,t,n)=>0===t||t===n.length-1)).join(">")}(t=function(e){var t=[];do{if(e.nodeType===u){var n=e.tagName;if(t.push(n),L.includes(n))break}}while(e=e.parentNode);return t}(t));if(v[o])return v[o];t=function(e,t){let n=e.body;do{var o=t.pop();o=e.createElement(o);n.appendChild(o),n=o}while(0<t.length);return n.textContent="​",n}((i=function(){if(f)return f.contentWindow;var e=document.characterSet||"UTF-8",t=(t=document.doctype)?(`<!DOCTYPE ${o(t.name)} ${o(t.publicId)} `+o(t.systemId)).trim()+">":"";return(f=document.createElement("iframe")).id="domtoimage-sandbox-"+n.uid(),f.style.visibility="hidden",f.style.position="fixed",document.body.appendChild(f),function(e,t,n,o){try{return e.contentWindow.document.write(t+`<html><head><meta charset='${n}'><title>${o}</title></head><body></body></html>`),e.contentWindow}catch(e){}var i=document.createElement("meta");i.setAttribute("charset",n);try{var r=document.implementation.createHTMLDocument(o),s=(r.head.appendChild(i),t+r.documentElement.outerHTML);return e.setAttribute("srcdoc",s),e.contentWindow}catch(e){}return e.contentDocument.head.appendChild(i),e.contentDocument.title=o,e.contentWindow}(f,t,e,"domtoimage-sandbox");function o(e){var t;return e?((t=document.createElement("div")).innerText=e,t.innerHTML):""}}()).document,t);var i=function(e,t){const o={},i=e.getComputedStyle(t);return n.asArray(i).forEach(function(e){o[e]="width"===e||"height"===e?"auto":i.getPropertyValue(e)}),o}(i,t);return function(e){do{var t=e.parentElement;null!==t&&t.removeChild(e),e=t}while(e&&"BODY"!==e.tagName)}(t),v[o]=i}(e,t):{},a=r.style;n.asArray(o).forEach(function(e){var t,n=o.getPropertyValue(e),r=s[e],l=i?i.getPropertyValue(e):void 0;(n!==r||i&&n!==l)&&(r=o.getPropertyPriority(e),l=a,n=n,r=r,t=0<=["background-clip"].indexOf(e=e),r?(l.setProperty(e,n,r),t&&l.setProperty("-webkit-"+e,n,r)):(l.setProperty(e,n),t&&l.setProperty("-webkit-"+e,n)))})}let y=null,v={};const L=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","SVG","TABLE","UL","math","svg","BODY","HEAD","HTML"]}(t)}),i=n(function(e,n){(function(){function n(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){a(o.response,t,n)},o.onerror=function(){console.error("could not download file")},o.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof t&&t.global===t?t:void 0,s=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,s){var a=r.URL||r.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):o(l.href)?n(e,t,s):i(l,l.target="_blank")):(l.href=a.createObjectURL(e),setTimeout(function(){a.revokeObjectURL(l.href)},4e4),setTimeout(function(){i(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,r),t);else if(o(e))n(e,t,r);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout(function(){i(s)})}}:function(e,t,o,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,o);var a="application/octet-stream"===e.type,l=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&l||s)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var d=r.URL||r.webkitURL,h=d.createObjectURL(e);i?i.location=h:location.href=h,i=null,setTimeout(function(){d.revokeObjectURL(h)},4e4)}});r.saveAs=a.saveAs=a,e.exports=a})()}),r=L.Control.extend({options:{cropImageByInnerWH:!0,hidden:!1,domtoimageOptions:{},position:"topleft",screenName:"screen",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDMyIDMyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMiAzMjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxnIGlkPSJjYW1lcmEiPjxwYXRoIHN0eWxlPSJmaWxsOiMwMTAwMDI7IiBkPSJNMTYsOS41MDFjLTQuNDE5LDAtOCwzLjU4MS04LDhjMCw0LjQxOCwzLjU4MSw4LDgsOGM0LjQxOCwwLDgtMy41ODIsOC04UzIwLjQxOCw5LjUwMSwxNiw5LjUwMXogTTIwLjU1NSwyMS40MDZjLTIuMTU2LDIuNTE2LTUuOTQzLDIuODA3LTguNDU5LDAuNjVjLTIuNTE3LTIuMTU2LTIuODA3LTUuOTQ0LTAuNjUtOC40NTljMi4xNTUtMi41MTcsNS45NDMtMi44MDcsOC40NTktMC42NUMyMi40MiwxNS4xMDIsMjIuNzExLDE4Ljg5MSwyMC41NTUsMjEuNDA2eiIvPjxwYXRoIHN0eWxlPSJmaWxsOiMwMTAwMDI7IiBkPSJNMTYsMTMuNTAxYy0yLjIwOSwwLTMuOTk5LDEuNzkxLTQsMy45OTl2MC4wMDJjMCwwLjI3NSwwLjIyNCwwLjUsMC41LDAuNXMwLjUtMC4yMjUsMC41LTAuNVYxNy41YzAuMDAxLTEuNjU2LDEuMzQzLTIuOTk5LDMtMi45OTljMC4yNzYsMCwwLjUtMC4yMjQsMC41LTAuNVMxNi4yNzYsMTMuNTAxLDE2LDEzLjUwMXoiLz48cGF0aCBzdHlsZT0iZmlsbDojMDEwMDAyOyIgZD0iTTI5LjQ5Miw4LjU0MmwtNC4zMzQtMC43MjNsLTEuMzczLTMuNDM0QzIzLjMyNiwzLjI0LDIyLjIzMiwyLjUsMjEsMi41SDExYy0xLjIzMiwwLTIuMzI2LDAuNzQtMi43ODYsMS44ODZMNi44NDIsNy44MTlMMi41MDksOC41NDJDMS4wNTUsOC43ODMsMCwxMC4wMjcsMCwxMS41djE1YzAsMS42NTQsMS4zNDYsMywzLDNoMjZjMS42NTQsMCwzLTEuMzQ2LDMtM3YtMTVDMzIsMTAuMDI3LDMwLjk0NSw4Ljc4MywyOS40OTIsOC41NDJ6IE0zMCwyNi41YzAsMC41NTMtMC40NDcsMS0xLDFIM2MtMC41NTMsMC0xLTAuNDQ3LTEtMXYtMTVjMC0wLjQ4OSwwLjM1NC0wLjkwNiwwLjgzNi0wLjk4Nkw4LjI4LDkuNjA3bDEuNzkxLTQuNDc4QzEwLjIyNCw0Ljc1LDEwLjU5MSw0LjUsMTEsNC41aDEwYzAuNDA4LDAsMC43NzUsMC4yNDksMC45MjgsMC42MjlsMS43OTEsNC40NzhsNS40NDUsMC45MDdDMjkuNjQ2LDEwLjU5NCwzMCwxMS4wMTEsMzAsMTEuNVYyNi41eiIvPjwvZz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PC9zdmc+",hideElementsWithSelectors:[".leaflet-control-container"],onCropBorderSize:2,caption:null,captionFontSize:15,captionFont:"Arial",captionColor:"black",captionBgColor:"white",captionOffset:5,mimeType:"image/png",debugMode:!1,preventDownload:!1,onPixelDataFail:function(e){var t=e.node,n=e.error;return console.warn("Map node is very big "+t.scrollWidth+"x"+t.scrollHeight),console.warn("Add function: SimpleMapScreenshoter({\n              onPixelDataFail: function({ node, plugin, error, mapPane, domtoimageOptions }) {\n                 // Solutions:\n                 // decrease size of map\n                 // or decrease zoom level\n                 // or remove elements with big distanses\n                 // and after that return image in Promise - plugin._getPixelDataOfNormalMap\n                 return plugin._getPixelDataOfNormalMap(domtoimageOptions)\n              }\n            })"),Promise.reject(n)}},onAdd:function(){return this._container=L.DomUtil.create("div","leaflet-control-simpleMapScreenshoter"),this._link=null,this._screenState={status:1,promise:null},!1===this.options.hidden&&this._addScreenBtn(),this._onUserStartInteractWithMap=this._onUserStartInteractWithMap.bind(this),this._onUserEndInteractWithMap=this._onUserEndInteractWithMap.bind(this),this._map.on("zoomstart",this._onUserStartInteractWithMap),this._map.on("move",this._onUserStartInteractWithMap),this._map.on("zoomend",this._onUserEndInteractWithMap),this._map.on("moveend",this._onUserEndInteractWithMap),this._container},takeScreen:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"blob",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o={};for(var i in this.options)n.hasOwnProperty(i)?o[i]=n[i]:o[i]=this.options[i];return 2===this._screenState.status?this._screenState.promise:(this._map.fire("simpleMapScreenshoter.takeScreen"),this._screenState.status=2,this._setElementsVisible(!1),this._screenState.promise=this._waitEndOfInteractions().then(function(){return e._getPixelData(o)}).then(function(t){return e._setElementsVisible(!0),e._toCanvas(t,o)}).then(function(n){return"image"===t?e._canvasToImage(n,o):"canvas"===t?n:e._canvasToBlob(n,o)}).then(function(t){return e._screenState.status=1,e._map.fire("simpleMapScreenshoter.done"),t}).catch(function(t){return e._setElementsVisible(!0),e._screenState.status=1,e._map.fire("simpleMapScreenshoter.error",{e:t}),Promise.reject(t)}),this._screenState.promise)},_setElementsVisible:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.hideElementsWithSelectors.forEach(function(n){var o=e._map._container.querySelectorAll(n),i=!0,r=!1,s=void 0;try{for(var a,l=o[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){a.value.style.opacity=!1===t?0:1}}catch(e){r=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw s}}})},_canvasToImage:function(e,t){var n=t.mimeType,o=e.toDataURL(n);return-1===o.indexOf("base64")?Promise.reject(new Error("Base64 image generation error")):Promise.resolve(o)},_canvasToBlob:function(e,t){var n=t.mimeType;return new Promise(function(t,o){e.toBlob(function(e){t(e)},n)})},_toCanvas:function(e,t){var n=t.captionOffset,o=t.caption,i=t.captionFontSize,r=t.captionFont,s=t.captionColor,a=t.captionBgColor,l=this._node,c=l.screenHeight,u=l.screenWidth,d=document.createElement("canvas");d.width=u,d.height=c;for(var h=d.getContext("2d"),p=h.createImageData(u,c),m=0;m<e.length;++m)p.data[m]=e[m];h.putImageData(p,0,0),p=null;var f=document.createElement("canvas"),g=f.getContext("2d"),w=0,M=0,y=c,v=u;if(!0===this.options.cropImageByInnerWH){for(var L=[],S=0,T=0;T<c;++T){S=0;for(var E=0;E<u;++E)0===e[4*T*u+4*E+4]&&S++;S===u&&L.push(T)}var C=this._getMinAndMaxOnValuesBreak(L);w=C.min;for(var D=u,b=C.max,P=[],x=0,N=M;N<D;++N){x=0;for(var j=0;j<c;++j)0===e[4*j*u+4*N+4]&&x++;x===c&&P.push(N)}var I=this._getMinAndMaxOnValuesBreak(P);M=I.min,D=I.max,(0===M&&0===D||null===D)&&(D=u),(0===w&&0===b||null===b)&&(b=c),!0===this.options.debugMode&&(console.log("emptyYLine",L),console.log("minMaxY",C),console.log("emptyXLine",P),console.log("minMaxX",I),console.log("debugX",{}),console.log("debugY",{})),0===w&&b===c&&0===M&&D===u||(w+=this.options.onCropBorderSize,b-=this.options.onCropBorderSize,M+=this.options.onCropBorderSize,D-=this.options.onCropBorderSize),y=b-w,v=D-M,f.width=v,f.height=y}else f.width=v,f.height=y;var O=null;return o&&(O="function"==typeof o?o.call(this):o),null!==O&&(f.height=f.height+(n+i+n),g.beginPath(),g.rect(0,0,f.width,f.height),g.fillStyle=a,g.fill(),g.save()),g.drawImage(d,M,w,v,y,0,0,v,y),null!==O&&(g.font=i+"px "+r,g.fillStyle=s,g.fillText(O,n,y+n+i)),Promise.resolve(f)},_getMinAndMaxOnValuesBreak:function(e){for(var t=0,n=0,o=!1,i=1;i<e.length;i++){if(e[i]-1!==e[i-1]){n=e[i],o=!0;break}t=e[i]}return!1===o&&e[0]>1?(t=0,n=e[0]):!1===o&&(t=e[e.length-1]||0,n=null),{min:t,max:n}},_getPixelData:function(e){var t=this,n=e.domtoimageOptions,o=void 0===n?{}:n;return this._getPixelDataOfNormalMap(o).catch(function(e){return console.warn("May be map size very big on that zoom level, we have error:",e.toString()),console.warn("You can manually hide map elements with large distances between them for fix that warn"),t._getPixelDataOfBigMap(o)})},_getPixelDataOfNormalMap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._map.getContainer();return this._node={node:t,screenHeight:t.scrollHeight,screenWidth:t.scrollWidth},o.toPixelData(t,e)},_getPixelDataOfBigMap:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this._map.getContainer(),i=this._map.getPane("mapPane");i.style.width=2*n.clientWidth+"px",i.style.height=2*n.clientHeight+"px",i.style.overflow="hidden";var r=function(){i.style.width="initial",i.style.height="initial",i.style.overflow="initial"};return this._node={node:n,screenHeight:n.scrollHeight,screenWidth:n.scrollWidth},o.toPixelData(n,t).then(function(e){return r(),e}).catch(function(o){return r(),n.scrollHeight>=4e3||n.scrollWidth>=4e3?e.options.onPixelDataFail({plugin:e,node:n,mapPane:i,error:o,domtoimageOptions:t}):Promise.reject(o)})},_addScreenBtn:function(){this._link=L.DomUtil.create("a","leaflet-control-simpleMapScreenshoter-btn",this._container),this._addCss(),L.DomEvent.addListener(this._link,"click",this._onScreenBtn,this),L.DomEvent.disableClickPropagation(this._link)},_addCss:function(){var e="\n    .leaflet-control-simpleMapScreenshoter{\n       border: 2px solid rgba(0,0,0,0.2);\n       background-clip: padding-box;\n    }\n    .leaflet-control-simpleMapScreenshoter a{\n       background-color: #fff;\n       border-bottom: 1px solid #ccc;\n       width: 30px;\n       height: 30px;\n       line-height: 30px;\n       display: block;\n       text-align: center;\n       text-decoration: none;\n       color: black;\n       overflow: hidden;\n       border-radius: 2px;\n       background-image: url('"+this.options.iconUrl+"');\n       background-position: 46% 41%;\n       background-repeat: no-repeat;\n       background-size: 63%;\n    }\n    .leaflet-control-simpleMapScreenshoter a:hover{\n       cursor: pointer;\n    }\n    ",t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.appendChild(document.createTextNode(e)),t.appendChild(n)},_onScreenBtn:function(){var e=this;this._map.fire("simpleMapScreenshoter.click"),this.options.preventDownload||this.takeScreen().then(function(t){var n="function"==typeof e.options.screenName?e.options.screenName.call(e):e.options.screenName;i.saveAs(t,n+".png")}).catch(function(t){e._map.fire("simpleMapScreenshoter.error",{e:t})})},_onUserStartInteractWithMap:function(){this._interaction=!0},_onUserEndInteractWithMap:function(){this._interaction=!1},_waitEndOfInteractions:function(){var e=this;return new Promise(function(t){var n=setInterval(function(){e._interaction||(t(),clearInterval(n))},100)})}}),s=(L.Control.SimpleMapScreenshoter=r,L.simpleMapScreenshoter=function(e){return new L.Control.SimpleMapScreenshoter(e)},r);e.default=s,e.SimpleMapScreenshoter=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=leaflet-simple-map-screenshoter.js.map
